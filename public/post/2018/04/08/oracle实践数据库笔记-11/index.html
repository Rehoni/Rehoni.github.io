<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <title>Oracleå®è·µæ•°æ®åº“ç¬”è®°-11 - Oracleå®¡æ ¸çš„æ“ä½œï¼Œè§¦å‘å™¨çš„ä»£ç å®ç°ï¼Œä»¥åŠæ•°æ®ç§»åŠ¨çš„æ“ä½œ  - Rehoni.</title>
    <meta property="og:title" content="Oracleå®è·µæ•°æ®åº“ç¬”è®°-11 - Rehoni.">
    
    <meta name="twitter:card" content="summary">

    
      
    

    
      
      <meta property="description" content="ç»†ç²’åº¦å®¡æ ¸(FGA)
desc dbms_fga;---STATEMENT_TYPESå®¡æ ¸è¯­å¥ç±»å‹ execute dbms_fga.add_policy(&#39;SCOTT&#39;,&#39;EMP&#39;,&#39;FGA_DEMO&#39;,STATEMENT_TYPES=&amp;gt;&#39;SELECT,INSERT,DELETE&#39;); ---æ‰§è¡Œselect,insert,deleteæ“ä½œ desc dba_fga_audit_trail &amp;hellip;">
      <meta property="og:description" content="ç»†ç²’åº¦å®¡æ ¸(FGA)
desc dbms_fga;---STATEMENT_TYPESå®¡æ ¸è¯­å¥ç±»å‹ execute dbms_fga.add_policy(&#39;SCOTT&#39;,&#39;EMP&#39;,&#39;FGA_DEMO&#39;,STATEMENT_TYPES=&amp;gt;&#39;SELECT,INSERT,DELETE&#39;); ---æ‰§è¡Œselect,insert,deleteæ“ä½œ desc dba_fga_audit_trail &amp;hellip;">
      
    

    
    
    <meta name="twitter:image" content="https://static.notion-static.com/801127da-7c3c-439e-8c98-4e9aa6330129/Untitled">
    
    

    

    
    


<link href='//cdn.bootcss.com/highlight.js/9.12.0/styles/github.min.css' rel='stylesheet' type='text/css' />



    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="/css/fonts.css" />
    <link rel="stylesheet" href="/css/custom.css" />

  </head>

  
  <body class="post">
    <header class="masthead">
      <h1><a href="/">Rehoni.</a></h1>

<p class="tagline">ä½ æœ‰åŒç‰§ç¾Šäººçš„çœ¼ç›ï¼Œåœ¨ä½ çœ¼é‡Œè°æ˜¯ç¾Šç¾¤ï¼Œæ¯«æ— å¤´ç»ª</p>

      <nav class="menu">
  <input id="menu-check" type="checkbox" />
  <label id="menu-label" for="menu-check" class="unselectable">
    <span class="icon close-icon">âœ•</span>
    <span class="icon open-icon">â˜°</span>
    <span class="text">Menu</span>
  </label>
  <ul>
  
  
  <li><a href="/">Home</a></li>
  
  <li><a href="/about/">About</a></li>
  
  <li><a href="/categories/">Categories</a></li>
  
  <li><a href="/tags/">Tags</a></li>
  
  <li><a href="/index.xml">Subscribe</a></li>
  
  
  </ul>
</nav>

    </header>

    <article class="main">
      <header class="title">
      
<h1>Oracleå®è·µæ•°æ®åº“ç¬”è®°-11</h1>
<h1><span class="subtitle">Oracleå®¡æ ¸çš„æ“ä½œï¼Œè§¦å‘å™¨çš„ä»£ç å®ç°ï¼Œä»¥åŠæ•°æ®ç§»åŠ¨çš„æ“ä½œ</span></h1>
<h3>
  2018-04-08</h3>
<hr>


      </header>





<h1 id="oracleå®è·µæ•°æ®åº“">Oracleå®è·µæ•°æ®åº“</h1>

<h2 id="å®¡æ ¸">å®¡æ ¸</h2>

<ul>
<li><strong>å¼ºåˆ¶å®¡æ ¸</strong></li>
<li><strong>æ ‡å‡†æ•°æ®åº“å®¡æ ¸</strong></li>
<li><strong>åŸºäºå€¼çš„å®¡æ ¸</strong></li>

<li><p><strong>ç»†ç²’åº¦å®¡æ ¸(FGA)</strong></p>

<pre><code class="language-sql">desc dbms_fga;---STATEMENT_TYPESå®¡æ ¸è¯­å¥ç±»å‹
execute dbms_fga.add_policy('SCOTT','EMP','FGA_DEMO',STATEMENT_TYPES=&gt;'SELECT,INSERT,DELETE');
---æ‰§è¡Œselect,insert,deleteæ“ä½œ
desc dba_fga_audit_trail
alter session set nls_date_format='yyyy-mm-dd hh24:mi:ss';
---ä¸­é—´è¿›è¡Œscottç”¨æˆ·ä¸‹çš„select,insertå’Œdeleteæ“ä½œ
select TIMESTAMP,DB_USER,SQL_TEXT from dba_fga_audit_trail
</code></pre></li>

<li><p><strong>å®¡æ ¸DBA</strong></p>

<pre><code class="language-sql">show parameter audit
</code></pre></li>
</ul>

<h2 id="è§¦å‘å™¨-å¤´éƒ¨-è§¦å‘æ¡ä»¶-è¢«è§¦å‘ä»£ç ">è§¦å‘å™¨(å¤´éƒ¨,è§¦å‘æ¡ä»¶,è¢«è§¦å‘ä»£ç )</h2>

<ul>
<li><strong>DMLè§¦å‘å™¨</strong></li>
</ul>

<p>æ·»åŠ for each rowè¿›è¡Œé€è¡Œæ“ä½œæ˜¾ç¤º</p>

<p>æ·»åŠ referencing old as o new as n for each row when(n.sal&gt;5000)è¿›è¡Œæ¡ä»¶</p>

<pre><code class="language-sql">    create table demo1(a varchar(20));
    create or replace trigger scott.tr1
    after update on scott.emp for each row
    begin
    	insert into scott.demo1 values('changed!');
    end;
    update emp set sal=2000 where empno=7369;
    select * from demo1;
    create or replace trigger scott.tr1
    after update on scott.emp referencing old as o new as n for each row when(n.sal&gt;5000)
    begin
    	insert into scott.demo1 values('changed!');
    end;
</code></pre>

<p><strong>åˆ›å»ºä¸€ä¸ªå·¥èµ„è¡¨, ç”¨è§¦å‘å™¨å®ç°æ›´æ”¹å·¥èµ„ä¹‹å, æ˜¾ç¤ºæ—§çš„å·¥èµ„å’Œæ–°çš„å·¥èµ„çš„å˜åŒ–</strong>ğŸ†—</p>

<pre><code class="language-sql">    create table sal_change(empno number(4),ename varchar2(10), old_sal number(7,2), new_sal number(7,2));
    create or replace trigger scott.tr1
    after update on scott.emp referencing old as o new as n for each row
    begin
      insert into scott.sal_change values(:o.empno, :o.ename,:o.sal,:n.sal);
    end;
    update emp set sal=4000 where empno=7902;
    select * from sal_change;
</code></pre>

<ul>
<li><p><strong>ç³»ç»Ÿè§¦å‘å™¨</strong></p>

<p><strong>å¦‚ç”¨æ¥è®°å½•ç”¨æˆ·çš„ç™»é™†æƒ…å†µ</strong></p>

<pre><code class="language-sql">login_rec +++(username,login_time)
create or replace trigger scott.tr1
after logon on database
begin
    insert into login_rec values ();
end;---scottæƒé™ä¸è¶³å¾—æ¢ç”¨æˆ·
alter session set nls_data_format='yyyy-mm-dd hh24:mi:ss';
desc dbms_shared_pool;---å…±äº«æ± 
desc v$db_object_cache;---å†…å­˜ä¸­çš„ä¸œè¥¿
select owner,name,type from v$db_object_cache
where owner&lt;&gt;'SYS' and kept='YES';---æŸ¥è¯¢å†…å­˜ä¸­çš„å†…å­˜
desc user_procedures;
select object_name,object_type from user_procedures
where object_type ='PROCEDURE';---æŸ¥è¯¢å­˜å‚¨è¿‡ç¨‹
execute dbms_shared_pool.keep('scott.p20');---ä¿æŒp20è¿™ä¸ªå­˜å‚¨è¿‡ç¨‹
select object_name,object_type from user_procedures
where object_type ='procedure';
</code></pre>

<p><strong>åˆ›å»ºä¸€ä¸ªstartupçš„è§¦å‘å™¨</strong></p>

<pre><code class="language-sql">create or replace procedure scott.p20
as
begin
null;
end;
/
select owner,name,type from v$db_object_cache
where owner&lt;&gt;'SYS' and kept='YES';---æŸ¥è¯¢ä¸€ä¸‹å†…å­˜ä¸­æ˜¯å¦å­˜åœ¨ N
execute dbms_shared_pool.keep('scott.p20');
select owner,name,type from v$db_object_cache
where owner&lt;&gt;'SYS' and kept='YES';---æŸ¥è¯¢ä¸€ä¸‹å†…å­˜ä¸­æ˜¯å¦å­˜åœ¨ Y
---ç»è¿‡shutdownå’Œstartupä¹‹å,p20åœ¨å†…å­˜ä¸­ä¸ä¼šå­˜åœ¨äº†
---å¦‚æœé‡è§shutdownå’Œstartupä¹‹å,æ“ä½œæŠ¥é”™å°±å†æ“ä½œä¸€é
shutdown immediate
startup
---å¦‚æœæ˜¯scott.tr2å°±æ˜¯åœ¨scottä¸‹è¿›è¡Œkeepæ“ä½œå°±éœ€è¦grantæƒé™
create or replace trigger tr2
after startup on database
begin
    sys.dbms_shared_pool.keep('scott.p20');
end;
shutdown immediate
startup
select owner,name,type from v$db_object_cache
where owner&lt;&gt;'SYS' and kept='YES';---æœ‰äº†
</code></pre></li>
</ul>

<h2 id="ç§»åŠ¨æ•°æ®">ç§»åŠ¨æ•°æ®</h2>

<ul>
<li><p><strong>æ•°æ®æ–‡ä»¶â€”&gt;æ•°æ®åº“</strong></p>

<ul>
<li><strong>cmdä¸‹sqlldr</strong></li>

<li><p><strong>cmdä¸‹exp/imp (exportå’Œimport)</strong></p>

<pre><code class="language-sql">æŸ¥è¯¢expå’Œimpçš„å‚æ•°
CMD&gt;exp help=y
      
å¯¼å‡ºå·¥èµ„åœ¨2500ä»¥ä¸Šçš„empè¡¨ä¸­çš„æ•°æ®---cmdä¸­
CMD&gt;exp scott/tiger file=d:\demo1.dmp tables=emp query='where sal&gt;2500'
æŠ¥é”™ LRM-00111: å€¼ 'where sal' ç¼ºå°‘å³å¼•å·
æ˜¯å› ä¸º&gt;æ˜¯ç®¡é“å‘½ä»¤,è¾“å‡ºçš„æ„æ€. å› æ­¤ä¼šåœ¨å½“å‰cmdç›®å½•ä¸‹äº§ç”Ÿä¸€ä¸ªåä¸º&quot;2500'&quot;çš„æ–‡ä»¶
å› æ­¤è¦å±è”½å¤§äºå·
CMD&gt;exp scott/tiger file=d:\demo1.dmp tables=emp query='where &quot;sal&gt;2500&quot;'
æˆ–è€…åœ¨&gt;SQLä¸­åŠ ä¸Š$è·‘
SQL&gt;$exp scott/tiger file=d:\demo1.dmp tables=emp query='where &quot;sal&gt;2500&quot;'
      
å­—ç¬¦é›†é—®é¢˜ 16è¿›åˆ¶-&gt;354å¯¹åº”å­—ç¬¦é›†id-&gt;852,æŸ¥è¯¢ä¸ºZHS16GBK
select nls_charset_name(852) from dual;
æ›´æ”¹å­—ç¬¦é›†ä¸ºWE8ISO8859P1,æŸ¥è¯¢è¯¥idå¾—åˆ°ä¸º31,è½¬ä¸º16è¿›åˆ¶-&gt;1F
select nls_charset_id('WE8ISO8859P1') from dual;
</code></pre></li>
</ul></li>
</ul>

<p><img src="https://static.notion-static.com/801127da-7c3c-439e-8c98-4e9aa6330129/Untitled" alt="æ•ˆæœå›¾" /></p>

<p><img src="https://static.notion-static.com/bb819c5c-0092-4d36-89f5-2a5a7609e4e6/Untitled" alt="æ•ˆæœå›¾" /></p>

<ul>
<li><p><strong>expdp/impdp æ•°æ®æ³µ, å¹¶è¡Œ(å¤§ä»»åŠ¡, è¶³å¤Ÿå¤šçš„ç©ºé—²èµ„æº)</strong></p>

<pre><code class="language-sql">  CMD&gt;expdp scott/tiger file=d:\demo2.dmp tables=emp
  æŠ¥é”™:
  ORA-39001: å‚æ•°å€¼æ— æ•ˆ
  ORA-39000: è½¬å‚¨æ–‡ä»¶è¯´æ˜é”™è¯¯
  ORA-39088: æ–‡ä»¶åä¸èƒ½åŒ…å«è·¯å¾„è¯´æ˜
  SQL&gt;create directory sha as 'd:\dxp' åªæ˜¯åœ¨æ•°æ®åº“ä¸­å£°æ˜,å®é™…ç›®å½•éœ€è¦åœ¨æ–‡ä»¶ä¸­åˆ›å»ºå¥½
  SQL&gt;grant read,write on directory sha to scott;
  CMD&gt;expdp scott/tiger directory=sha file=demo2.dmp tables=emp
  SQL&gt;conn scott/tiger
  SQL&gt;drop table emp;
  CMD&gt;impdp scott/tiger directory=sha file=demo2.dmp tables=emp
</code></pre></li>
</ul>

<p><img src="https://static.notion-static.com/2b622c7a-1bf2-4fe6-b312-3553fc69ab74/Untitled" alt="4" /></p>

<p><img src="https://static.notion-static.com/f5f13bc0-df35-459a-a931-6d09a4ea7682/Untitled" alt="5" /></p>

<ul>
<li><strong>æ•°æ®åº“&lt;â€”&gt;æ•°æ®åº“</strong></li>
<li><strong>æ•°æ®åº“â€”&gt;æ•°æ®æ–‡ä»¶</strong></li>
</ul>


  <footer>
  
<nav class="post-nav">
  <span class="nav-prev">&larr; <a href="/post/2018/04/08/oracle%E5%AE%9E%E8%B7%B5%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0-12/">Oracleå®è·µæ•°æ®åº“ç¬”è®°-12</a></span>
  <span class="nav-next"><a href="/post/2018/04/08/java%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%E5%8D%B74/">Javaæ ¸å¿ƒæŠ€æœ¯å·(4)</a> &rarr;</span>
</nav>





<script src="//yihui.name/js/math-code.js"></script>
<script async src="//mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML"></script>

<script async src="//yihui.name/js/center-img.js"></script>

  



<script src="//cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>



<script src="//cdn.bootcss.com/highlight.js/9.12.0/languages/r.min.js"></script>
<script src="//cdn.bootcss.com/highlight.js/9.12.0/languages/yaml.min.js"></script>
<script src="//cdn.bootcss.com/highlight.js/9.12.0/languages/tex.min.js"></script>
<script>hljs.configure({languages: []}); hljs.initHighlightingOnLoad();</script>



  
  <hr>
  <div class="copyright">&copy; <a href="https://github.com/rehoni">Rehoni</a> 2019 | <a href="resliya@outlook.com">Email</a> | <a href="https://www.zhihu.com/people/luo-hao-37-27/activities">ZhiHu</a></div>
  
  </footer>
  </article>
  
  </body>
</html>

